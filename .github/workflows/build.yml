name: Build From Script

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build_job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # שלב 1: ניקוי ה-Workspace (שומר רק על ה-YML וה-SH)
      - name: Cleanup Environment
        run: |
          find . -maxdepth 1 -type f ! -name "*.yml" ! -name "*.sh" -delete
          # אם יש תיקיות, נמחק גם אותן כדי שהפרויקט ייווצר על נקי
          find . -maxdepth 1 -type d ! -name "." ! -name ".github" ! -name ".git" -exec rm -rf {} +
          echo "Workspace is clean. Only script and workflow remains."

      # שלב 2: התקנת סביבת עבודה (Android SDK & Java)
      # הסקריפט שלך צריך את הכלים האלה מותקנים במכונה כדי להצליח
      - name: set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # שלב 3: הרצת הסקריפט שלך
      - name: Run Creation Script
        run: |
          # מחפש את קובץ ה-sh שלך ונותן לו הרשאת הרצה
          chmod +x *.sh
          # מריץ את הסקריפט (בהנחה שיש רק אחד, או שנה את השם למפורש)
          ./*.sh 

      # שלב 4: העלאת ה-APK (בדיקה איפה הסקריפט שלך שומר אותו)
      - name: Upload Resulting APK
        uses: actions/upload-artifact@v4
        with:
          name: generated-apk
          # כאן צריך להיזהר: אם הסקריפט שלך יוצר את ה-APK בתיקייה מסוימת, ציין אותה.
          # הנתיב למטה מחפש כל קובץ APK שנוצר בכל מקום בתיקייה
          path: "**/*.apk"
